import Tkinter as tk
from Tkinter import *
import BeautifulSoup
from BeautifulSoup import BeautifulSoup
import re
import config
import os

def successPopup():
    popup = tk.Tk()
    popup.geometry("200x50")
    error = Label(popup, text="Success!")
    okButton = Button(popup, text="OK", command=popup.destroy)
    error.pack()
    okButton.pack()
    popup.mainloop()


def errorPopup(error):
    popup = tk.Tk()
    popup.geometry("200x50")
    error = Label(popup, text="An error occured: " + error)
    okButton = Button(popup, text="OK", command=popup.destroy)
    error.pack()
    okButton.pack()
    popup.mainloop()

def addHash(hash):

    with open(config.tempDictionaryList, "a") as d:
        d.writelines(hash + "\n")
        d.close()

def removeDuplicateLines():

    append = open(config.dictionaryList, "a")
    read = open(config.tempDictionaryList, "r")
    with append as d:
        for line in read:
            d.writelines(line)
        d.close()

    uniqlines = set(open(config.dictionaryList).readlines())
    append = open(config.dictionaryList, "w")
    with append as a:
        a.writelines(set(uniqlines))
        a.close()

    read = open(config.tempDictionaryList, "w")
    with read as t:
        t.write("")
        t.close()

def enterHash(hash):
    if not os.path.exists(config.tempDictionaryList):
        tempDictionary = open("temp.txt", "w+")
    r = re.compile("([a-fA-F\d]{32})")
    if r.match(hash) and len(hash) == 32:
        addHash(hash)
        removeDuplicateLines()
        successPopup()
    else:
        errorPopup("Invalid Hash")

def enterDictionary():
    if not os.path.exists(config.dictionaryList):
        mainDictionary = open("dictionary.txt", "w+")

    if not os.path.exists(config.tempDictionaryList):
        print("file does not exist")
        tempDictionary = open("temp.txt", "w+")

    if config.dictionaryFile.endswith(".txt"):
        r = re.compile("([a-fA-F\d]{32})")

        with open(config.dictionaryFile, "r") as f:
            for line in f:
                if r.match(str(line.strip())) and len(str(line.strip())) == 32:
                    addHash(str(line.strip()))
            f.close()

        removeDuplicateLines()
        successPopup()
    elif config.dictionaryFile.endswith(".html"):
        file = open(config.dictionaryFile, "r")
        r = re.compile("([a-fA-F\d]{32})")

        with file as f:
            soup = BeautifulSoup(f)
            hashList = soup.getText().split()
            for line in hashList:
                if r.match(line) and len(str(line)) == 32:
                    addHash(line)
            f.close()
            removeDuplicateLines()
            successPopup()
    else:
        errorPopup("Invalid file selected")
